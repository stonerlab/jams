SHELL = /bin/sh

withdebug=0

cputype = $(shell uname -m | sed "s/\\ /_/g")
systype = $(shell uname -s)


# Compiler information
CXX = c++
OPTFLAGS = -O3 -funroll-all-loops -DCUDA
COPTIONS = -Wall -pedantic -std=c++98 -pipe -Wno-long-long

# Linker information
LDOPTIONS = 
LD = $(CXX)

# Compile input/output file specification
SOURCEFILE = -c $<
OUTPUTFILE = -o $@

# Output specification for executables
EXEOUTPUTFILE = -o $@

#----------------------------------------------------------------------
# System based overides
#----------------------------------------------------------------------

ifeq ($(systype),Linux)
	COPTIONS += -DLinux
endif

ifeq ($(systype),Darwin)
	CXX = g++ 
	COPTIONS += -j4 -DDarwin
endif

#----------------------------------------------------------------------
# Build specific options 
#----------------------------------------------------------------------
ifeq ($(withdebug),1)
	OPTFLAGS += -g -DDEBUG
	LDOPTIONS += -g
else 
	OPTFLAGS += -DNDEBUG	# turn off asserts
endif

LIBCONFIGDIR = ./libconfig

header-dirs = $(sort $(dir $(shell find $(TOPDIR) -name '*.h'))) 
HEADERS = $(foreach d, $(header-dirs), $(wildcard $d*.h)) Makefile

INCLUDES = $(foreach d, $(header-dirs), -I$d) -I/usr/local/cuda/include 
CFLAGS = $(COPTIONS) $(OPTFLAGS) $(INCLUDES)

LIBSDIR = -L/usr/local/cuda/lib64
LIBS = -lfftw3 -lconfig++ -lcuda -lcudart -lcurand -lcublas -lcusparse
LDFLAGS = $(LIBSDIR)
