#ifndef INCLUDED_JAMS_CUDA_PISD_EXCHANGE_KERNEL
#define INCLUDED_JAMS_CUDA_PISD_EXCHANGE_KERNEL

#include <jams/helpers/consts.h>

__global__ void cuda_pisd_exchange_field_kernel(const double Bz, const double beta,
    const unsigned int num_spins, const double * dev_s, const int * dev_rows, const int * dev_cols, const double * dev_vals, double * dev_h) {
  using std::pow;

  const unsigned int idx = blockIdx.x * blockDim.x + threadIdx.x;

  if (idx < num_spins) {
    const double gmuB = kElectronGFactor * kBohrMagnetonIU;

    double h_i[3] = {0.0, 0.0, 0.0};

    double nx1 = dev_s[3*idx + 0];
    double ny1 = dev_s[3*idx + 1];
    double nz1 = dev_s[3*idx + 2];

    for (auto m = dev_rows[idx]; m < dev_rows[idx + 1]; ++m) {
      auto j = dev_cols[m];
      double nx2 = dev_s[3*j + 0];
      double ny2 = dev_s[3*j + 1];
      double nz2 = dev_s[3*j + 2];

      double J = dev_vals[m];

        h_i[0] =  2.0*(-0.25*nx1*(pow(nx1, 2) + pow(ny1, 2))*(pow(nx2, 2) + pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-beta*(Bz*gmuB - 0.25*J))/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 2)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 3)) - 0.25*nx1*(pow(nx1, 2) + pow(ny1, 2))*(pow(nx2, 2) + pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-beta*(Bz*gmuB - 0.25*J))/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 3)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 2)) + 0.5*nx1*(pow(nx2, 2) + pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-beta*(Bz*gmuB - 0.25*J))/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 2)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 2)) + 0.25*nx1*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-beta*(-Bz*gmuB - 0.25*J))/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2) + 0.25*nx1*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-beta*(-Bz*gmuB - 0.25*J))/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)) - 0.125*nx1*(pow(nx1, 2)*pow(nz2, 2) + 2*pow(nx1, 2)*nz2 + pow(nx1, 2) - 2*nx1*nx2*nz1*nz2 - 2*nx1*nx2*nz1 - 2*nx1*nx2*nz2 - 2*nx1*nx2 + pow(nx2, 2)*pow(nz1, 2) + 2*pow(nx2, 2)*nz1 + pow(nx2, 2) + pow(ny1, 2)*pow(nz2, 2) + 2*pow(ny1, 2)*nz2 + pow(ny1, 2) - 2*ny1*ny2*nz1*nz2 - 2*ny1*ny2*nz1 - 2*ny1*ny2*nz2 - 2*ny1*ny2 + pow(ny2, 2)*pow(nz1, 2) + 2*pow(ny2, 2)*nz1 + pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-0.75*J*beta)/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 2)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 3)) - 0.125*nx1*(pow(nx1, 2)*pow(nz2, 2) + 2*pow(nx1, 2)*nz2 + pow(nx1, 2) + 2*nx1*nx2*nz1*nz2 + 2*nx1*nx2*nz1 + 2*nx1*nx2*nz2 + 2*nx1*nx2 + pow(nx2, 2)*pow(nz1, 2) + 2*pow(nx2, 2)*nz1 + pow(nx2, 2) + pow(ny1, 2)*pow(nz2, 2) + 2*pow(ny1, 2)*nz2 + pow(ny1, 2) + 2*ny1*ny2*nz1*nz2 + 2*ny1*ny2*nz1 + 2*ny1*ny2*nz2 + 2*ny1*ny2 + pow(ny2, 2)*pow(nz1, 2) + 2*pow(ny2, 2)*nz1 + pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(0.25*J*beta)/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 2)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 3)) - 0.125*nx1*(pow(nx1, 2)*pow(nz2, 2) + 2*pow(nx1, 2)*nz2 + pow(nx1, 2) - 2*nx1*nx2*nz1*nz2 - 2*nx1*nx2*nz1 - 2*nx1*nx2*nz2 - 2*nx1*nx2 + pow(nx2, 2)*pow(nz1, 2) + 2*pow(nx2, 2)*nz1 + pow(nx2, 2) + pow(ny1, 2)*pow(nz2, 2) + 2*pow(ny1, 2)*nz2 + pow(ny1, 2) - 2*ny1*ny2*nz1*nz2 - 2*ny1*ny2*nz1 - 2*ny1*ny2*nz2 - 2*ny1*ny2 + pow(ny2, 2)*pow(nz1, 2) + 2*pow(ny2, 2)*nz1 + pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-0.75*J*beta)/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 3)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 2)) - 0.125*nx1*(pow(nx1, 2)*pow(nz2, 2) + 2*pow(nx1, 2)*nz2 + pow(nx1, 2) + 2*nx1*nx2*nz1*nz2 + 2*nx1*nx2*nz1 + 2*nx1*nx2*nz2 + 2*nx1*nx2 + pow(nx2, 2)*pow(nz1, 2) + 2*pow(nx2, 2)*nz1 + pow(nx2, 2) + pow(ny1, 2)*pow(nz2, 2) + 2*pow(ny1, 2)*nz2 + pow(ny1, 2) + 2*ny1*ny2*nz1*nz2 + 2*ny1*ny2*nz1 + 2*ny1*ny2*nz2 + 2*ny1*ny2 + pow(ny2, 2)*pow(nz1, 2) + 2*pow(ny2, 2)*nz1 + pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(0.25*J*beta)/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 3)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 2)) + (0.25*nx1*pow(nz2, 2) + 0.5*nx1*nz2 + 0.25*nx1 - 0.25*nx2*nz1*nz2 - 0.25*nx2*nz1 - 0.25*nx2*nz2 - 0.25*nx2)*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-0.75*J*beta)/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 2)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 2)) + 0.125*(2*nx1*pow(nz2, 2) + 4*nx1*nz2 + 2*nx1 + 2*nx2*nz1*nz2 + 2*nx2*nz1 + 2*nx2*nz2 + 2*nx2)*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(0.25*J*beta)/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 2)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 2)))/(beta*gmuB*(0.25*(pow(nx1, 2) + pow(ny1, 2))*(pow(nx2, 2) + pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-beta*(Bz*gmuB - 0.25*J))/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 2)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 2)) + 0.25*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-beta*(-Bz*gmuB - 0.25*J)) + (0.125*pow(nx1, 2)*pow(nz2, 2) + 0.25*pow(nx1, 2)*nz2 + 0.125*pow(nx1, 2) - 0.25*nx1*nx2*nz1*nz2 - 0.25*nx1*nx2*nz1 - 0.25*nx1*nx2*nz2 - 0.25*nx1*nx2 + 0.125*pow(nx2, 2)*pow(nz1, 2) + 0.25*pow(nx2, 2)*nz1 + 0.125*pow(nx2, 2) + 0.125*pow(ny1, 2)*pow(nz2, 2) + 0.25*pow(ny1, 2)*nz2 + 0.125*pow(ny1, 2) - 0.25*ny1*ny2*nz1*nz2 - 0.25*ny1*ny2*nz1 - 0.25*ny1*ny2*nz2 - 0.25*ny1*ny2 + 0.125*pow(ny2, 2)*pow(nz1, 2) + 0.25*pow(ny2, 2)*nz1 + 0.125*pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-0.75*J*beta)/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 2)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 2)) + 0.125*(pow(nx1, 2)*pow(nz2, 2) + 2*pow(nx1, 2)*nz2 + pow(nx1, 2) + 2*nx1*nx2*nz1*nz2 + 2*nx1*nx2*nz1 + 2*nx1*nx2*nz2 + 2*nx1*nx2 + pow(nx2, 2)*pow(nz1, 2) + 2*pow(nx2, 2)*nz1 + pow(nx2, 2) + pow(ny1, 2)*pow(nz2, 2) + 2*pow(ny1, 2)*nz2 + pow(ny1, 2) + 2*ny1*ny2*nz1*nz2 + 2*ny1*ny2*nz1 + 2*ny1*ny2*nz2 + 2*ny1*ny2 + pow(ny2, 2)*pow(nz1, 2) + 2*pow(ny2, 2)*nz1 + pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(0.25*J*beta)/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 2)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 2)))) ;
        h_i[1] =  2.0*(-0.25*ny1*(pow(nx1, 2) + pow(ny1, 2))*(pow(nx2, 2) + pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-beta*(Bz*gmuB - 0.25*J))/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 2)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 3)) - 0.25*ny1*(pow(nx1, 2) + pow(ny1, 2))*(pow(nx2, 2) + pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-beta*(Bz*gmuB - 0.25*J))/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 3)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 2)) + 0.5*ny1*(pow(nx2, 2) + pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-beta*(Bz*gmuB - 0.25*J))/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 2)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 2)) + 0.25*ny1*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-beta*(-Bz*gmuB - 0.25*J))/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2) + 0.25*ny1*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-beta*(-Bz*gmuB - 0.25*J))/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)) - 0.125*ny1*(pow(nx1, 2)*pow(nz2, 2) + 2*pow(nx1, 2)*nz2 + pow(nx1, 2) - 2*nx1*nx2*nz1*nz2 - 2*nx1*nx2*nz1 - 2*nx1*nx2*nz2 - 2*nx1*nx2 + pow(nx2, 2)*pow(nz1, 2) + 2*pow(nx2, 2)*nz1 + pow(nx2, 2) + pow(ny1, 2)*pow(nz2, 2) + 2*pow(ny1, 2)*nz2 + pow(ny1, 2) - 2*ny1*ny2*nz1*nz2 - 2*ny1*ny2*nz1 - 2*ny1*ny2*nz2 - 2*ny1*ny2 + pow(ny2, 2)*pow(nz1, 2) + 2*pow(ny2, 2)*nz1 + pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-0.75*J*beta)/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 2)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 3)) - 0.125*ny1*(pow(nx1, 2)*pow(nz2, 2) + 2*pow(nx1, 2)*nz2 + pow(nx1, 2) + 2*nx1*nx2*nz1*nz2 + 2*nx1*nx2*nz1 + 2*nx1*nx2*nz2 + 2*nx1*nx2 + pow(nx2, 2)*pow(nz1, 2) + 2*pow(nx2, 2)*nz1 + pow(nx2, 2) + pow(ny1, 2)*pow(nz2, 2) + 2*pow(ny1, 2)*nz2 + pow(ny1, 2) + 2*ny1*ny2*nz1*nz2 + 2*ny1*ny2*nz1 + 2*ny1*ny2*nz2 + 2*ny1*ny2 + pow(ny2, 2)*pow(nz1, 2) + 2*pow(ny2, 2)*nz1 + pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(0.25*J*beta)/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 2)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 3)) - 0.125*ny1*(pow(nx1, 2)*pow(nz2, 2) + 2*pow(nx1, 2)*nz2 + pow(nx1, 2) - 2*nx1*nx2*nz1*nz2 - 2*nx1*nx2*nz1 - 2*nx1*nx2*nz2 - 2*nx1*nx2 + pow(nx2, 2)*pow(nz1, 2) + 2*pow(nx2, 2)*nz1 + pow(nx2, 2) + pow(ny1, 2)*pow(nz2, 2) + 2*pow(ny1, 2)*nz2 + pow(ny1, 2) - 2*ny1*ny2*nz1*nz2 - 2*ny1*ny2*nz1 - 2*ny1*ny2*nz2 - 2*ny1*ny2 + pow(ny2, 2)*pow(nz1, 2) + 2*pow(ny2, 2)*nz1 + pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-0.75*J*beta)/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 3)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 2)) - 0.125*ny1*(pow(nx1, 2)*pow(nz2, 2) + 2*pow(nx1, 2)*nz2 + pow(nx1, 2) + 2*nx1*nx2*nz1*nz2 + 2*nx1*nx2*nz1 + 2*nx1*nx2*nz2 + 2*nx1*nx2 + pow(nx2, 2)*pow(nz1, 2) + 2*pow(nx2, 2)*nz1 + pow(nx2, 2) + pow(ny1, 2)*pow(nz2, 2) + 2*pow(ny1, 2)*nz2 + pow(ny1, 2) + 2*ny1*ny2*nz1*nz2 + 2*ny1*ny2*nz1 + 2*ny1*ny2*nz2 + 2*ny1*ny2 + pow(ny2, 2)*pow(nz1, 2) + 2*pow(ny2, 2)*nz1 + pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(0.25*J*beta)/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 3)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 2)) + (0.25*ny1*pow(nz2, 2) + 0.5*ny1*nz2 + 0.25*ny1 - 0.25*ny2*nz1*nz2 - 0.25*ny2*nz1 - 0.25*ny2*nz2 - 0.25*ny2)*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-0.75*J*beta)/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 2)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 2)) + 0.125*(2*ny1*pow(nz2, 2) + 4*ny1*nz2 + 2*ny1 + 2*ny2*nz1*nz2 + 2*ny2*nz1 + 2*ny2*nz2 + 2*ny2)*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(0.25*J*beta)/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 2)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 2)))/(beta*gmuB*(0.25*(pow(nx1, 2) + pow(ny1, 2))*(pow(nx2, 2) + pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-beta*(Bz*gmuB - 0.25*J))/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 2)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 2)) + 0.25*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-beta*(-Bz*gmuB - 0.25*J)) + (0.125*pow(nx1, 2)*pow(nz2, 2) + 0.25*pow(nx1, 2)*nz2 + 0.125*pow(nx1, 2) - 0.25*nx1*nx2*nz1*nz2 - 0.25*nx1*nx2*nz1 - 0.25*nx1*nx2*nz2 - 0.25*nx1*nx2 + 0.125*pow(nx2, 2)*pow(nz1, 2) + 0.25*pow(nx2, 2)*nz1 + 0.125*pow(nx2, 2) + 0.125*pow(ny1, 2)*pow(nz2, 2) + 0.25*pow(ny1, 2)*nz2 + 0.125*pow(ny1, 2) - 0.25*ny1*ny2*nz1*nz2 - 0.25*ny1*ny2*nz1 - 0.25*ny1*ny2*nz2 - 0.25*ny1*ny2 + 0.125*pow(ny2, 2)*pow(nz1, 2) + 0.25*pow(ny2, 2)*nz1 + 0.125*pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-0.75*J*beta)/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 2)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 2)) + 0.125*(pow(nx1, 2)*pow(nz2, 2) + 2*pow(nx1, 2)*nz2 + pow(nx1, 2) + 2*nx1*nx2*nz1*nz2 + 2*nx1*nx2*nz1 + 2*nx1*nx2*nz2 + 2*nx1*nx2 + pow(nx2, 2)*pow(nz1, 2) + 2*pow(nx2, 2)*nz1 + pow(nx2, 2) + pow(ny1, 2)*pow(nz2, 2) + 2*pow(ny1, 2)*nz2 + pow(ny1, 2) + 2*ny1*ny2*nz1*nz2 + 2*ny1*ny2*nz1 + 2*ny1*ny2*nz2 + 2*ny1*ny2 + pow(ny2, 2)*pow(nz1, 2) + 2*pow(ny2, 2)*nz1 + pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(0.25*J*beta)/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 2)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 2)))) ;
        h_i[2] =  2.0*(-0.25*nz1*(pow(nx1, 2) + pow(ny1, 2))*(pow(nx2, 2) + pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-beta*(Bz*gmuB - 0.25*J))/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 2)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 3)) + 0.25*nz1*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-beta*(-Bz*gmuB - 0.25*J))/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2) - 0.125*nz1*(pow(nx1, 2)*pow(nz2, 2) + 2*pow(nx1, 2)*nz2 + pow(nx1, 2) - 2*nx1*nx2*nz1*nz2 - 2*nx1*nx2*nz1 - 2*nx1*nx2*nz2 - 2*nx1*nx2 + pow(nx2, 2)*pow(nz1, 2) + 2*pow(nx2, 2)*nz1 + pow(nx2, 2) + pow(ny1, 2)*pow(nz2, 2) + 2*pow(ny1, 2)*nz2 + pow(ny1, 2) - 2*ny1*ny2*nz1*nz2 - 2*ny1*ny2*nz1 - 2*ny1*ny2*nz2 - 2*ny1*ny2 + pow(ny2, 2)*pow(nz1, 2) + 2*pow(ny2, 2)*nz1 + pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-0.75*J*beta)/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 2)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 3)) - 0.125*nz1*(pow(nx1, 2)*pow(nz2, 2) + 2*pow(nx1, 2)*nz2 + pow(nx1, 2) + 2*nx1*nx2*nz1*nz2 + 2*nx1*nx2*nz1 + 2*nx1*nx2*nz2 + 2*nx1*nx2 + pow(nx2, 2)*pow(nz1, 2) + 2*pow(nx2, 2)*nz1 + pow(nx2, 2) + pow(ny1, 2)*pow(nz2, 2) + 2*pow(ny1, 2)*nz2 + pow(ny1, 2) + 2*ny1*ny2*nz1*nz2 + 2*ny1*ny2*nz1 + 2*ny1*ny2*nz2 + 2*ny1*ny2 + pow(ny2, 2)*pow(nz1, 2) + 2*pow(ny2, 2)*nz1 + pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(0.25*J*beta)/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 2)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 3)) + 0.25*(pow(nx1, 2) + pow(ny1, 2))*(pow(nx2, 2) + pow(ny2, 2))*(-2*nz1 - 2)*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-beta*(Bz*gmuB - 0.25*J))/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 3)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 2)) - 0.25*(pow(nx1, 2) + pow(ny1, 2))*(pow(nx2, 2) + pow(ny2, 2))*(-nz1 - 1)*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-beta*(Bz*gmuB - 0.25*J))/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 3)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 2)) + 0.125*(-2*nz1 - 2)*(pow(nx1, 2)*pow(nz2, 2) + 2*pow(nx1, 2)*nz2 + pow(nx1, 2) - 2*nx1*nx2*nz1*nz2 - 2*nx1*nx2*nz1 - 2*nx1*nx2*nz2 - 2*nx1*nx2 + pow(nx2, 2)*pow(nz1, 2) + 2*pow(nx2, 2)*nz1 + pow(nx2, 2) + pow(ny1, 2)*pow(nz2, 2) + 2*pow(ny1, 2)*nz2 + pow(ny1, 2) - 2*ny1*ny2*nz1*nz2 - 2*ny1*ny2*nz1 - 2*ny1*ny2*nz2 - 2*ny1*ny2 + pow(ny2, 2)*pow(nz1, 2) + 2*pow(ny2, 2)*nz1 + pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-0.75*J*beta)/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 3)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 2)) + 0.125*(-2*nz1 - 2)*(pow(nx1, 2)*pow(nz2, 2) + 2*pow(nx1, 2)*nz2 + pow(nx1, 2) + 2*nx1*nx2*nz1*nz2 + 2*nx1*nx2*nz1 + 2*nx1*nx2*nz2 + 2*nx1*nx2 + pow(nx2, 2)*pow(nz1, 2) + 2*pow(nx2, 2)*nz1 + pow(nx2, 2) + pow(ny1, 2)*pow(nz2, 2) + 2*pow(ny1, 2)*nz2 + pow(ny1, 2) + 2*ny1*ny2*nz1*nz2 + 2*ny1*ny2*nz1 + 2*ny1*ny2*nz2 + 2*ny1*ny2 + pow(ny2, 2)*pow(nz1, 2) + 2*pow(ny2, 2)*nz1 + pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(0.25*J*beta)/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 3)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 2)) - 0.125*(-nz1 - 1)*(pow(nx1, 2)*pow(nz2, 2) + 2*pow(nx1, 2)*nz2 + pow(nx1, 2) - 2*nx1*nx2*nz1*nz2 - 2*nx1*nx2*nz1 - 2*nx1*nx2*nz2 - 2*nx1*nx2 + pow(nx2, 2)*pow(nz1, 2) + 2*pow(nx2, 2)*nz1 + pow(nx2, 2) + pow(ny1, 2)*pow(nz2, 2) + 2*pow(ny1, 2)*nz2 + pow(ny1, 2) - 2*ny1*ny2*nz1*nz2 - 2*ny1*ny2*nz1 - 2*ny1*ny2*nz2 - 2*ny1*ny2 + pow(ny2, 2)*pow(nz1, 2) + 2*pow(ny2, 2)*nz1 + pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-0.75*J*beta)/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 3)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 2)) - 0.125*(-nz1 - 1)*(pow(nx1, 2)*pow(nz2, 2) + 2*pow(nx1, 2)*nz2 + pow(nx1, 2) + 2*nx1*nx2*nz1*nz2 + 2*nx1*nx2*nz1 + 2*nx1*nx2*nz2 + 2*nx1*nx2 + pow(nx2, 2)*pow(nz1, 2) + 2*pow(nx2, 2)*nz1 + pow(nx2, 2) + pow(ny1, 2)*pow(nz2, 2) + 2*pow(ny1, 2)*nz2 + pow(ny1, 2) + 2*ny1*ny2*nz1*nz2 + 2*ny1*ny2*nz1 + 2*ny1*ny2*nz2 + 2*ny1*ny2 + pow(ny2, 2)*pow(nz1, 2) + 2*pow(ny2, 2)*nz1 + pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(0.25*J*beta)/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 3)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 2)) + (0.25*nz1 + 0.25)*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-beta*(-Bz*gmuB - 0.25*J))/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)) + (-0.25*nx1*nx2*nz2 - 0.25*nx1*nx2 + 0.25*pow(nx2, 2)*nz1 + 0.25*pow(nx2, 2) - 0.25*ny1*ny2*nz2 - 0.25*ny1*ny2 + 0.25*pow(ny2, 2)*nz1 + 0.25*pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-0.75*J*beta)/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 2)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 2)) + 0.125*(2*nx1*nx2*nz2 + 2*nx1*nx2 + 2*pow(nx2, 2)*nz1 + 2*pow(nx2, 2) + 2*ny1*ny2*nz2 + 2*ny1*ny2 + 2*pow(ny2, 2)*nz1 + 2*pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(0.25*J*beta)/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 2)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 2)))/(beta*gmuB*(0.25*(pow(nx1, 2) + pow(ny1, 2))*(pow(nx2, 2) + pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-beta*(Bz*gmuB - 0.25*J))/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 2)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 2)) + 0.25*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-beta*(-Bz*gmuB - 0.25*J)) + (0.125*pow(nx1, 2)*pow(nz2, 2) + 0.25*pow(nx1, 2)*nz2 + 0.125*pow(nx1, 2) - 0.25*nx1*nx2*nz1*nz2 - 0.25*nx1*nx2*nz1 - 0.25*nx1*nx2*nz2 - 0.25*nx1*nx2 + 0.125*pow(nx2, 2)*pow(nz1, 2) + 0.25*pow(nx2, 2)*nz1 + 0.125*pow(nx2, 2) + 0.125*pow(ny1, 2)*pow(nz2, 2) + 0.25*pow(ny1, 2)*nz2 + 0.125*pow(ny1, 2) - 0.25*ny1*ny2*nz1*nz2 - 0.25*ny1*ny2*nz1 - 0.25*ny1*ny2*nz2 - 0.25*ny1*ny2 + 0.125*pow(ny2, 2)*pow(nz1, 2) + 0.25*pow(ny2, 2)*nz1 + 0.125*pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(-0.75*J*beta)/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 2)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 2)) + 0.125*(pow(nx1, 2)*pow(nz2, 2) + 2*pow(nx1, 2)*nz2 + pow(nx1, 2) + 2*nx1*nx2*nz1*nz2 + 2*nx1*nx2*nz1 + 2*nx1*nx2*nz2 + 2*nx1*nx2 + pow(nx2, 2)*pow(nz1, 2) + 2*pow(nx2, 2)*nz1 + pow(nx2, 2) + pow(ny1, 2)*pow(nz2, 2) + 2*pow(ny1, 2)*nz2 + pow(ny1, 2) + 2*ny1*ny2*nz1*nz2 + 2*ny1*ny2*nz1 + 2*ny1*ny2*nz2 + 2*ny1*ny2 + pow(ny2, 2)*pow(nz1, 2) + 2*pow(ny2, 2)*nz1 + pow(ny2, 2))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2)))*1.0/(1.0/((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2))*exp(0.25*J*beta)/(pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + nz1 + (1.0/2.0)*pow(nz2, 2), 2)*pow((1.0/2.0)*pow(nx1, 2) + (1.0/2.0)*pow(nx2, 2) + (1.0/2.0)*pow(ny1, 2) + (1.0/2.0)*pow(ny2, 2) + (1.0/2.0)*pow(nz1, 2) + (1.0/2.0)*pow(nz2, 2) + nz2, 2)))) ;
    }

    for (auto n = 0; n < 3; ++n) {
      dev_h[3*idx + n] = h_i[n];
    }
  }
}

#endif
// ----------------------------- END-OF-FILE ----------------------------------