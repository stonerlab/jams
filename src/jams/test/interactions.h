//
// Created by Joseph Barker on 2019-01-28.
//

#ifndef JAMS_TEST_INTERACTIONS_H
#define JAMS_TEST_INTERACTIONS_H

#include <fstream>
#include "jams/core/interactions.h"
#include "mock.h"

std::ifstream dummy_file(std::string filename, std::string contents) {
  std::ofstream file(filename);
  file << contents;
  file.close();

  return std::ifstream(filename);
}

TEST(exchange_file_format_from_string, valid) {
  EXPECT_EQ(interaction_file_format_from_string("KKR"), InteractionFileFormat::KKR);
  EXPECT_EQ(interaction_file_format_from_string("kkr"), InteractionFileFormat::KKR);
  EXPECT_EQ(interaction_file_format_from_string("JAMS"), InteractionFileFormat::JAMS);
  EXPECT_EQ(interaction_file_format_from_string("jams"), InteractionFileFormat::JAMS);
}

TEST(exchange_file_format_from_string, invalid) {
  EXPECT_THROW(interaction_file_format_from_string(""), std::runtime_error);
  EXPECT_THROW(interaction_file_format_from_string("ABC"), std::runtime_error);
}

TEST(coordinate_format_from_string, valid) {
  EXPECT_EQ(coordinate_format_from_string("cart"), CoordinateFormat::CARTESIAN);
  EXPECT_EQ(coordinate_format_from_string("cartesian"), CoordinateFormat::CARTESIAN);
  EXPECT_EQ(coordinate_format_from_string("frac"), CoordinateFormat::FRACTIONAL);
  EXPECT_EQ(coordinate_format_from_string("fractional"), CoordinateFormat::FRACTIONAL);
}

TEST(coordinate_format_from_string, invalid) {
  EXPECT_THROW(coordinate_format_from_string(""), std::runtime_error);
  EXPECT_THROW(coordinate_format_from_string("car"), std::runtime_error);
  EXPECT_THROW(coordinate_format_from_string("ABC"), std::runtime_error);
}

TEST(discover_interaction_file_format, valid) {
  {
    auto file = dummy_file("exc.in", "A  B  0.0 0.0 0.1 1e-21\n");
    EXPECT_TRUE(discover_interaction_file_format(file) ==
      InteractionFileDescription(InteractionFileFormat::JAMS, InteractionType::SCALAR));
  }

  {
    auto file = dummy_file("exc.in", "1  1  0.0 0.0 0.1 1e-21\n");
    EXPECT_TRUE(discover_interaction_file_format(file) ==
      InteractionFileDescription(InteractionFileFormat::KKR, InteractionType::SCALAR));
  }

  {
    auto file = dummy_file("exc.in", "A  B  0.0 0.0 0.1 1e-21 0.0 0.0 0.0 1e-21 0.0 0.0 0.0 1e-21\n");
    EXPECT_TRUE(discover_interaction_file_format(file) ==
      InteractionFileDescription(InteractionFileFormat::JAMS, InteractionType::TENSOR));
  }

  {
    auto file = dummy_file("exc.in", "1  1  0.0 0.0 0.1 1e-21 0.0 0.0 0.0 1e-21 0.0 0.0 0.0 1e-21\n");
    EXPECT_TRUE(discover_interaction_file_format(file) ==
      InteractionFileDescription(InteractionFileFormat::KKR, InteractionType::TENSOR));
  }

}

TEST(discover_interaction_file_format, invalid) {
  {
    auto file = dummy_file("exc.in", "A  1  0.0 0.0 0.1 1e-21\n");
    EXPECT_THROW(discover_interaction_file_format(file), std::runtime_error);
  }
  {
    auto file = dummy_file("exc.in", "A  A  0.0 0.1 1e-21\n");
    EXPECT_THROW(discover_interaction_file_format(file), std::runtime_error);
  }

  {
    auto file = dummy_file("exc.in", "A  A  0.0 0.0 0.1 1e-21 1e-21 1e-21\n");
    EXPECT_THROW(discover_interaction_file_format(file), std::runtime_error);
  }

  {
    auto file = dummy_file("exc.in", "0.0 0.0 0.1 1e-21\n");
    EXPECT_THROW(discover_interaction_file_format(file), std::runtime_error);
  }
}

TEST(interactions_from_file, jams_scalar) {
  auto file = dummy_file("exc.in", "A  A  0.0 0.0 1.0 1e-21\nB  A  0.0 0.0 2.0 2e-21\n");
  InteractionFileDescription desc = discover_interaction_file_format(file);
  auto interactions = interactions_from_file(file, desc);

  Vec3 zero_r = {0.0, 0.0, 1.0};
  Mat3 zero_J = {1e-21, 0.0, 0.0, 0.0, 1e-21, 0.0, 0.0, 0.0, 1e-21};
  EXPECT_EQ(interactions[0].type_i, "A");
  EXPECT_EQ(interactions[0].type_j, "A");
  EXPECT_EQ(interactions[0].unit_cell_pos_i, -1);
  EXPECT_EQ(interactions[0].unit_cell_pos_j, -1);
  EXPECT_EQ(interactions[0].r_ij, zero_r);
  EXPECT_EQ(interactions[0].J_ij, zero_J);

  Vec3 one_r = {0.0, 0.0, 2.0};
  Mat3 one_J = {2e-21, 0.0, 0.0, 0.0, 2e-21, 0.0, 0.0, 0.0, 2e-21};
  EXPECT_EQ(interactions[1].type_i, "B");
  EXPECT_EQ(interactions[1].type_j, "A");
  EXPECT_EQ(interactions[1].unit_cell_pos_i, -1);
  EXPECT_EQ(interactions[1].unit_cell_pos_j, -1);
  EXPECT_EQ(interactions[1].r_ij, one_r);
  EXPECT_EQ(interactions[1].J_ij, one_J);
}

TEST(interactions_from_file, jams_tensor) {
  auto file = dummy_file("exc.in",
          "A  A  0.0 0.0 1.0 1e-21 0.0 0.0 0.0 1e-21 0.0 0.0 0.0 1e-21\n"
          "B  A  0.0 0.0 2.0 2e-21 0.0 0.0 0.0 2e-21 0.0 0.0 0.0 2e-21\n");
  InteractionFileDescription desc = discover_interaction_file_format(file);
  auto interactions = interactions_from_file(file, desc);

  Vec3 zero_r = {0.0, 0.0, 1.0};
  Mat3 zero_J = {1e-21, 0.0, 0.0, 0.0, 1e-21, 0.0, 0.0, 0.0, 1e-21};
  EXPECT_EQ(interactions[0].type_i, "A");
  EXPECT_EQ(interactions[0].type_j, "A");
  EXPECT_EQ(interactions[0].unit_cell_pos_i, -1);
  EXPECT_EQ(interactions[0].unit_cell_pos_j, -1);
  EXPECT_EQ(interactions[0].r_ij, zero_r);
  EXPECT_EQ(interactions[0].J_ij, zero_J);

  Vec3 one_r = {0.0, 0.0, 2.0};
  Mat3 one_J = {2e-21, 0.0, 0.0, 0.0, 2e-21, 0.0, 0.0, 0.0, 2e-21};
  EXPECT_EQ(interactions[1].type_i, "B");
  EXPECT_EQ(interactions[1].type_j, "A");
  EXPECT_EQ(interactions[1].unit_cell_pos_i, -1);
  EXPECT_EQ(interactions[1].unit_cell_pos_j, -1);
  EXPECT_EQ(interactions[1].r_ij, one_r);
  EXPECT_EQ(interactions[1].J_ij, one_J);
}

TEST(interactions_from_file, kkr_scalar) {
  auto file = dummy_file("exc.in", "1  1  0.0 0.0 1.0 1e-21\n2  1  0.0 0.0 2.0 2e-21\n");
  InteractionFileDescription desc = discover_interaction_file_format(file);
  auto interactions = interactions_from_file(file, desc);

  Vec3 zero_r = {0.0, 0.0, 1.0};
  Mat3 zero_J = {1e-21, 0.0, 0.0, 0.0, 1e-21, 0.0, 0.0, 0.0, 1e-21};
  EXPECT_EQ(interactions[0].type_i, "NOTYPE");
  EXPECT_EQ(interactions[0].type_j, "NOTYPE");
  EXPECT_EQ(interactions[0].unit_cell_pos_i, 0);
  EXPECT_EQ(interactions[0].unit_cell_pos_j, 0);
  EXPECT_EQ(interactions[0].r_ij, zero_r);
  EXPECT_EQ(interactions[0].J_ij, zero_J);

  Vec3 one_r = {0.0, 0.0, 2.0};
  Mat3 one_J = {2e-21, 0.0, 0.0, 0.0, 2e-21, 0.0, 0.0, 0.0, 2e-21};
  EXPECT_EQ(interactions[1].type_i, "NOTYPE");
  EXPECT_EQ(interactions[1].type_j, "NOTYPE");
  EXPECT_EQ(interactions[1].unit_cell_pos_i, 1);
  EXPECT_EQ(interactions[1].unit_cell_pos_j, 0);
  EXPECT_EQ(interactions[1].r_ij, one_r);
  EXPECT_EQ(interactions[1].J_ij, one_J);
}

TEST(interactions_from_file, kkr_tensor) {
  auto file = dummy_file("exc.in",
          "1  1  0.0 0.0 1.0 1e-21 0.0 0.0 0.0 1e-21 0.0 0.0 0.0 1e-21\n"
          "2  1  0.0 0.0 2.0 2e-21 0.0 0.0 0.0 2e-21 0.0 0.0 0.0 2e-21\n");
  InteractionFileDescription desc = discover_interaction_file_format(file);
  auto interactions = interactions_from_file(file, desc);

  Vec3 zero_r = {0.0, 0.0, 1.0};
  Mat3 zero_J = {1e-21, 0.0, 0.0, 0.0, 1e-21, 0.0, 0.0, 0.0, 1e-21};
  EXPECT_EQ(interactions[0].type_i, "NOTYPE");
  EXPECT_EQ(interactions[0].type_j, "NOTYPE");
  EXPECT_EQ(interactions[0].unit_cell_pos_i, 0);
  EXPECT_EQ(interactions[0].unit_cell_pos_j, 0);
  EXPECT_EQ(interactions[0].r_ij, zero_r);
  EXPECT_EQ(interactions[0].J_ij, zero_J);

  Vec3 one_r = {0.0, 0.0, 2.0};
  Mat3 one_J = {2e-21, 0.0, 0.0, 0.0, 2e-21, 0.0, 0.0, 0.0, 2e-21};
  EXPECT_EQ(interactions[1].type_i, "NOTYPE");
  EXPECT_EQ(interactions[1].type_j, "NOTYPE");
  EXPECT_EQ(interactions[1].unit_cell_pos_i, 1);
  EXPECT_EQ(interactions[1].unit_cell_pos_j, 0);
  EXPECT_EQ(interactions[1].r_ij, one_r);
  EXPECT_EQ(interactions[1].J_ij, one_J);
}

TEST_F(MockJamsTest, generate_interactions_simple_cubic) {
  SetUp(R"(
    solver : {
      module = "llg-heun-cpu";
      t_step = 1.0e-16;
      t_min  = 1.0e-16;
      t_max  = 1.0e-16;
    };

    materials = (
      { name      = "A";
        moment    = 2.5;
        spin      = [0.0, 0.0, 1.0];
      }
    );

    unitcell: {
      parameter = 0.3e-9;

      basis = (
        [1.0, 0.0, 0.0],
        [0.0, 1.0, 0.0],
        [0.0, 0.0, 1.0]);

      positions = (
        ("A", [0.00, 0.00, 0.00]));
    };

    lattice : {
      size     = [8, 8, 8];
      periodic = [true, true, true];
    };

    physics : {
      temperature = 1.0;
    };

    hamiltonians = (
      {
      module = "exchange";
      interactions = (
        ("A", "A", [0.0, 0.0, 1.0], 3.5e-21),
        ("A", "A", [0.0, 0.0, 1.0], 3.5e-21)
      );
      symops = true;
      }
    );
    )");

    auto& settings = config->lookup("hamiltonians");

    auto neighbour_list = generate_neighbour_list(settings[0]["interactions"]);

    EXPECT_EQ(neighbour_list.num_interactions(), 8*8*8*6);

    for (int i = 0; i < neighbour_list.size(); ++i) {
      for (auto const &j: neighbour_list[i]) {
        EXPECT_EQ(j.second, diagonal_matrix(3.5e-21));
      }
    }
}

TEST_F(MockJamsTest, generate_interactions_yig) {
SetUp(R"(
    solver : {
      module = "llg-heun-cpu";
      t_step = 1.0e-16;
      t_min  = 1.0e-16;
      t_max  = 1.0e-16;
    };

    lattice : {
      size     = [8, 8, 8];
      periodic = [true, true, true];
    };

    unitcell: {
      parameter = 1.2376e-9;

      basis = (
       [-0.5, 0.5, 0.5],
       [ 0.5,-0.5, 0.5],
       [ 0.5, 0.5,-0.5]);

      format = "fractional";

      positions = (
        ("FeA",  [0.000000,  0.000000,  0.000000]),
        ("FeA",  [0.000000,  0.000000,  0.500000]),
        ("FeA",  [0.500000,  0.500000,  0.000000]),
        ("FeA",  [0.500000,  0.000000,  0.000000]),
        ("FeA",  [0.000000,  0.500000,  0.000000]),
        ("FeA",  [0.500000,  0.000000,  0.500000]),
        ("FeA",  [0.500000,  0.500000,  0.500000]),
        ("FeA",  [0.000000,  0.500000,  0.500000]),
        ("FeD",  [0.250000,  0.625000,  0.375000]),
        ("FeD",  [0.750000,  0.375000,  0.625000]),
        ("FeD",  [0.375000,  0.250000,  0.625000]),
        ("FeD",  [0.625000,  0.750000,  0.375000]),
        ("FeD",  [0.375000,  0.625000,  0.750000]),
        ("FeD",  [0.625000,  0.375000,  0.250000]),
        ("FeD",  [0.125000,  0.750000,  0.875000]),
        ("FeD",  [0.875000,  0.250000,  0.125000]),
        ("FeD",  [0.125000,  0.875000,  0.250000]),
        ("FeD",  [0.875000,  0.125000,  0.750000]),
        ("FeD",  [0.250000,  0.125000,  0.875000]),
        ("FeD",  [0.750000,  0.875000,  0.125000]) );
    };

    materials = (
      { name      = "FeD";
        moment    = 5.00;
        spin      = [0.0, 0.0, 1.0];
      },
      { name      = "FeA";
        moment    = 5.00;
        spin      = [0.0, 0.0, -1.0];
      }
    );

    physics : {
      temperature = 1.0;
    };

    hamiltonians = (
      {
      module = "exchange";
      exc_file = "yig_princep_exc.in";
      }
    );
    )");

auto exc_file = dummy_file("yig_princep_exc.in",R"(
1 15  -0.250  0.125 0.000 -6.80925E-21
1 16  0.250 -0.125  0.000 -6.80925E-21
1 17  0.000 0.250 -0.125  -6.80925E-21
1 18  0.000 -0.250  0.125 -6.80925E-21
1 19  -0.125  0.000 0.250 -6.80925E-21
1 20  0.125 0.000 -0.250  -6.80925E-21
2 11  0.000 0.125 0.250 -6.80925E-21
2 12  0.000 -0.125  -0.250  -6.80925E-21
2 17  -0.250  0.000 0.125 -6.80925E-21
2 18  0.250 0.000 -0.125  -6.80925E-21
2 19  0.125 0.250 0.000 -6.80925E-21
2 20  -0.125  -0.250  0.000 -6.80925E-21
3 11  -0.250  -0.125  0.000 -6.80925E-21
3 12  0.250 0.125 0.000 -6.80925E-21
3 13  0.000 -0.250  0.125 -6.80925E-21
3 14  0.000 0.250 -0.125  -6.80925E-21
3 19  -0.125  0.000 -0.250  -6.80925E-21
3 20  0.125 0.000 0.250 -6.80925E-21
4 13  -0.250  0.000 -0.125  -6.80925E-21
4 14  0.250 0.000 0.125 -6.80925E-21
4 15  0.000 -0.125  -0.250  -6.80925E-21
4 16  0.000 0.125 0.250 -6.80925E-21
4 19  0.125 -0.250  0.000 -6.80925E-21
4 20  -0.125  0.250 0.000 -6.80925E-21
5 9 0.125 0.250 0.000 -6.80925E-21
5 10  -0.125  -0.250  0.000 -6.80925E-21
5 15  0.000 -0.125  0.250 -6.80925E-21
5 16  0.000 0.125 -0.250  -6.80925E-21
5 17  0.250 0.000 0.125 -6.80925E-21
5 18  -0.250  0.000 -0.125  -6.80925E-21
6 9 -0.125  0.000 -0.250  -6.80925E-21
6 10  0.125 0.000 0.250 -6.80925E-21
6 11  0.250 -0.125  0.000 -6.80925E-21
6 12  -0.250  0.125 0.000 -6.80925E-21
6 17  0.000 -0.250  -0.125  -6.80925E-21
6 18  0.000 0.250 0.125 -6.80925E-21
7 9 0.125 -0.250  0.000 -6.80925E-21
7 10  -0.125  0.250 0.000 -6.80925E-21
7 11  0.000 0.125 -0.250  -6.80925E-21
7 12  0.000 -0.125  0.250 -6.80925E-21
7 13  0.250 0.000 -0.125  -6.80925E-21
7 14  -0.250  0.000 0.125 -6.80925E-21
8 9 -0.125  0.000 0.250 -6.80925E-21
8 10  0.125 0.000 -0.250  -6.80925E-21
8 13  0.000 0.250 0.125 -6.80925E-21
8 14  0.000 -0.250  -0.125  -6.80925E-21
8 15  0.250 0.125 0.000 -6.80925E-21
8 16  -0.250  -0.125  0.000 -6.80925E-21
9 5 -0.125  -0.250  0.000 -6.80925E-21
9 6 0.125 0.000 0.250 -6.80925E-21
9 7 -0.125  0.250 0.000 -6.80925E-21
9 8 0.125 0.000 -0.250  -6.80925E-21
10  5 0.125 0.250 0.000 -6.80925E-21
10  6 -0.125  0.000 -0.250  -6.80925E-21
10  7 0.125 -0.250  0.000 -6.80925E-21
10  8 -0.125  0.000 0.250 -6.80925E-21
11  2 0.000 -0.125  -0.250  -6.80925E-21
11  3 0.250 0.125 0.000 -6.80925E-21
11  6 -0.250  0.125 0.000 -6.80925E-21
11  7 0.000 -0.125  0.250 -6.80925E-21
12  2 0.000 0.125 0.250 -6.80925E-21
12  3 -0.250  -0.125  0.000 -6.80925E-21
12  6 0.250 -0.125  0.000 -6.80925E-21
12  7 0.000 0.125 -0.250  -6.80925E-21
13  3 0.000 0.250 -0.125  -6.80925E-21
13  4 0.250 0.000 0.125 -6.80925E-21
13  7 -0.250  0.000 0.125 -6.80925E-21
13  8 0.000 -0.250  -0.125  -6.80925E-21
14  3 0.000 -0.250  0.125 -6.80925E-21
14  4 -0.250  0.000 -0.125  -6.80925E-21
14  7 0.250 0.000 -0.125  -6.80925E-21
14  8 0.000 0.250 0.125 -6.80925E-21
15  1 0.250 -0.125  0.000 -6.80925E-21
15  4 0.000 0.125 0.250 -6.80925E-21
15  5 0.000 0.125 -0.250  -6.80925E-21
15  8 -0.250  -0.125  0.000 -6.80925E-21
16  1 -0.250  0.125 0.000 -6.80925E-21
16  4 0.000 -0.125  -0.250  -6.80925E-21
16  5 0.000 -0.125  0.250 -6.80925E-21
16  8 0.250 0.125 0.000 -6.80925E-21
17  1 0.000 -0.250  0.125 -6.80925E-21
17  2 0.250 0.000 -0.125  -6.80925E-21
17  5 -0.250  0.000 -0.125  -6.80925E-21
17  6 0.000 0.250 0.125 -6.80925E-21
18  1 0.000 0.250 -0.125  -6.80925E-21
18  2 -0.250  0.000 0.125 -6.80925E-21
18  5 0.250 0.000 0.125 -6.80925E-21
18  6 0.000 -0.250  -0.125  -6.80925E-21
19  1 0.125 0.000 -0.250  -6.80925E-21
19  2 -0.125  -0.250  0.000 -6.80925E-21
19  3 0.125 0.000 0.250 -6.80925E-21
19  4 -0.125  0.250 0.000 -6.80925E-21
20  1 -0.125  0.000 0.250 -6.80925E-21
20  2 0.125 0.250 0.000 -6.80925E-21
20  3 -0.125  0.000 -0.250  -6.80925E-21
20  4 0.125 -0.250  0.000 -6.80925E-21
1 7 -0.250  -0.250  -0.250  -1.10150E-21
1 7 0.250 0.250 0.250 -1.10150E-21
2 8 -0.250  0.250 -0.250  -1.10150E-21
2 8 0.250 -0.250  0.250 -1.10150E-21
3 5 -0.250  0.250 0.250 -1.10150E-21
3 5 0.250 -0.250  -0.250  -1.10150E-21
4 6 -0.250  -0.250  0.250 -1.10150E-21
4 6 0.250 0.250 -0.250  -1.10150E-21
5 3 0.250 -0.250  -0.250  -1.10150E-21
5 3 -0.250  0.250 0.250 -1.10150E-21
6 4 -0.250  -0.250  0.250 -1.10150E-21
6 4 0.250 0.250 -0.250  -1.10150E-21
7 1 0.250 0.250 0.250 -1.10150E-21
7 1 -0.250  -0.250  -0.250  -1.10150E-21
8 2 0.250 -0.250  0.250 -1.10150E-21
8 2 -0.250  0.250 -0.250  -1.10150E-21
9 11  -0.125  0.375 -0.250  -4.70639E-22
9 11  0.375 -0.125  0.250 -4.70639E-22
9 14  0.125 -0.250  -0.375  -4.70639E-22
9 14  -0.375  0.250 0.125 -4.70639E-22
9 15  -0.125  -0.375  0.250 -4.70639E-22
9 15  0.375 0.125 -0.250  -4.70639E-22
9 18  -0.375  -0.250  -0.125  -4.70639E-22
9 18  0.125 0.250 0.375 -4.70639E-22
10  12  0.125 -0.375  0.250 -4.70639E-22
10  12  -0.375  0.125 -0.250  -4.70639E-22
10  13  -0.125  0.250 0.375 -4.70639E-22
10  13  0.375 -0.250  -0.125  -4.70639E-22
10  16  0.125 0.375 -0.250  -4.70639E-22
10  16  -0.375  -0.125  0.250 -4.70639E-22
10  17  0.375 0.250 0.125 -4.70639E-22
10  17  -0.125  -0.250  -0.375  -4.70639E-22
11  9 0.125 -0.375  0.250 -4.70639E-22
11  9 -0.375  0.125 -0.250  -4.70639E-22
11  14  0.250 0.375 -0.125  -4.70639E-22
11  14  -0.250  -0.125  0.375 -4.70639E-22
11  18  -0.250  0.375 0.125 -4.70639E-22
11  18  0.250 -0.125  -0.375  -4.70639E-22
11  20  0.375 0.125 0.250 -4.70639E-22
11  20  -0.125  -0.375  -0.250  -4.70639E-22
12  10  -0.125  0.375 -0.250  -4.70639E-22
12  10  0.375 -0.125  0.250 -4.70639E-22
12  13  -0.250  -0.375  0.125 -4.70639E-22
12  13  0.250 0.125 -0.375  -4.70639E-22
12  17  0.250 -0.375  -0.125  -4.70639E-22
12  17  -0.250  0.125 0.375 -4.70639E-22
12  19  -0.375  -0.125  -0.250  -4.70639E-22
12  19  0.125 0.375 0.250 -4.70639E-22
13  10  0.125 -0.250  -0.375  -4.70639E-22
13  10  -0.375  0.250 0.125 -4.70639E-22
13  12  0.250 0.375 -0.125  -4.70639E-22
13  12  -0.250  -0.125  0.375 -4.70639E-22
13  16  -0.250  -0.375  -0.125  -4.70639E-22
13  16  0.250 0.125 0.375 -4.70639E-22
13  19  0.375 -0.250  0.125 -4.70639E-22
13  19  -0.125  0.250 -0.375  -4.70639E-22
14  9 -0.125  0.250 0.375 -4.70639E-22
14  9 0.375 -0.250  -0.125  -4.70639E-22
14  11  -0.250  -0.375  0.125 -4.70639E-22
14  11  0.250 0.125 -0.375  -4.70639E-22
14  15  0.250 0.375 0.125 -4.70639E-22
14  15  -0.250  -0.125  -0.375  -4.70639E-22
14  20  -0.375  0.250 -0.125  -4.70639E-22
14  20  0.125 -0.250  0.375 -4.70639E-22
15  9 0.125 0.375 -0.250  -4.70639E-22
15  9 -0.375  -0.125  0.250 -4.70639E-22
15  14  -0.250  -0.375  -0.125  -4.70639E-22
15  14  0.250 0.125 0.375 -4.70639E-22
15  18  -0.250  0.125 -0.375  -4.70639E-22
15  18  0.250 -0.375  0.125 -4.70639E-22
15  20  0.375 -0.125  -0.250  -4.70639E-22
15  20  -0.125  0.375 0.250 -4.70639E-22
16  10  -0.125  -0.375  0.250 -4.70639E-22
16  10  0.375 0.125 -0.250  -4.70639E-22
16  13  0.250 0.375 0.125 -4.70639E-22
16  13  -0.250  -0.125  -0.375  -4.70639E-22
16  17  0.250 -0.125  0.375 -4.70639E-22
16  17  -0.250  0.375 -0.125  -4.70639E-22
16  19  -0.375  0.125 0.250 -4.70639E-22
16  19  0.125 -0.375  -0.250  -4.70639E-22
17  10  -0.375  -0.250  -0.125  -4.70639E-22
17  10  0.125 0.250 0.375 -4.70639E-22
17  12  -0.250  0.375 0.125 -4.70639E-22
17  12  0.250 -0.125  -0.375  -4.70639E-22
17  16  -0.250  0.125 -0.375  -4.70639E-22
17  16  0.250 -0.375  0.125 -4.70639E-22
17  19  0.375 0.250 -0.125  -4.70639E-22
17  19  -0.125  -0.250  0.375 -4.70639E-22
18  9 0.375 0.250 0.125 -4.70639E-22
18  9 -0.125  -0.250  -0.375  -4.70639E-22
18  11  0.250 -0.375  -0.125  -4.70639E-22
18  11  -0.250  0.125 0.375 -4.70639E-22
18  15  0.250 -0.125  0.375 -4.70639E-22
18  15  -0.250  0.375 -0.125  -4.70639E-22
18  20  -0.375  -0.250  0.125 -4.70639E-22
18  20  0.125 0.250 -0.375  -4.70639E-22
19  12  0.375 0.125 0.250 -4.70639E-22
19  12  -0.125  -0.375  -0.250  -4.70639E-22
19  13  -0.375  0.250 -0.125  -4.70639E-22
19  13  0.125 -0.250  0.375 -4.70639E-22
19  16  0.375 -0.125  -0.250  -4.70639E-22
19  16  -0.125  0.375 0.250 -4.70639E-22
19  17  -0.375  -0.250  0.125 -4.70639E-22
19  17  0.125 0.250 -0.375  -4.70639E-22
20  11  -0.375  -0.125  -0.250  -4.70639E-22
20  11  0.125 0.375 0.250 -4.70639E-22
20  14  0.375 -0.250  0.125 -4.70639E-22
20  14  -0.125  0.250 -0.375  -4.70639E-22
20  15  -0.375  0.125 0.250 -4.70639E-22
20  15  0.125 -0.375  -0.250  -4.70639E-22
20  18  0.375 0.250 -0.125  -4.70639E-22
20  18  -0.125  -0.250  0.375 -4.70639E-22
9 12  -0.125  0.125 0.250 -5.20707E-22
9 13  0.125 0.250 -0.125  -5.20707E-22
9 16  -0.125  -0.125  -0.250  -5.20707E-22
9 17  0.125 -0.250  0.125 -5.20707E-22
10  11  0.125 -0.125  -0.250  -5.20707E-22
10  14  -0.125  -0.250  0.125 -5.20707E-22
10  15  0.125 0.125 0.250 -5.20707E-22
10  18  -0.125  0.250 -0.125  -5.20707E-22
11  10  -0.125  0.125 0.250 -5.20707E-22
11  13  0.250 -0.125  0.125 -5.20707E-22
11  17  -0.250  -0.125  -0.125  -5.20707E-22
11  19  0.125 0.125 -0.250  -5.20707E-22
12  9 0.125 -0.125  -0.250  -5.20707E-22
12  14  -0.250  0.125 -0.125  -5.20707E-22
12  18  0.250 0.125 0.125 -5.20707E-22
12  20  -0.125  -0.125  0.250 -5.20707E-22
13  9 -0.125  -0.250  0.125 -5.20707E-22
13  11  -0.250  0.125 -0.125  -5.20707E-22
13  15  0.250 -0.125  -0.125  -5.20707E-22
13  20  0.125 0.250 0.125 -5.20707E-22
14  10  0.125 0.250 -0.125  -5.20707E-22
14  12  0.250 -0.125  0.125 -5.20707E-22
14  16  -0.250  0.125 0.125 -5.20707E-22
14  19  -0.125  -0.250  -0.125  -5.20707E-22
15  10  -0.125  -0.125  -0.250  -5.20707E-22
15  13  -0.250  0.125 0.125 -5.20707E-22
15  17  0.250 0.125 -0.125  -5.20707E-22
15  19  0.125 -0.125  0.250 -5.20707E-22
16  9 0.125 0.125 0.250 -5.20707E-22
16  14  0.250 -0.125  -0.125  -5.20707E-22
16  18  -0.250  -0.125  0.125 -5.20707E-22
16  20  -0.125  0.125 -0.250  -5.20707E-22
17  9 -0.125  0.250 -0.125  -5.20707E-22
17  11  0.250 0.125 0.125 -5.20707E-22
17  15  -0.250  -0.125  0.125 -5.20707E-22
17  20  0.125 -0.250  -0.125  -5.20707E-22
18  10  0.125 -0.250  0.125 -5.20707E-22
18  12  -0.250  -0.125  -0.125  -5.20707E-22
18  16  0.250 0.125 -0.125  -5.20707E-22
18  19  -0.125  0.250 0.125 -5.20707E-22
19  11  -0.125  -0.125  0.250 -5.20707E-22
19  14  0.125 0.250 0.125 -5.20707E-22
19  15  -0.125  0.125 -0.250  -5.20707E-22
19  18  0.125 -0.250  -0.125  -5.20707E-22
20  12  0.125 0.125 -0.250  -5.20707E-22
20  13  -0.125  -0.250  -0.125  -5.20707E-22
20  16  0.125 -0.125  0.250 -5.20707E-22
20  17  -0.125  0.250 0.125 -5.20707E-22
1 9 0.375 0.000 0.250 7.00952E-23
1 10  -0.375  0.000 -0.250  7.00952E-23
1 11  0.250 0.375 0.000 7.00952E-23
1 12  -0.250  -0.375  0.000 7.00952E-23
1 13  0.000 -0.250  -0.375  7.00952E-23
1 14  0.000 0.250 0.375 7.00952E-23
2 9 -0.375  0.250 0.000 7.00952E-23
2 10  0.375 -0.250  0.000 7.00952E-23
2 13  0.250 0.000 0.375 7.00952E-23
2 14  -0.250  0.000 -0.375  7.00952E-23
2 15  0.000 0.375 -0.250  7.00952E-23
2 16  0.000 -0.375  0.250 7.00952E-23
3 9 0.375 0.000 -0.250  7.00952E-23
3 10  -0.375  0.000 0.250 7.00952E-23
3 15  0.250 -0.375  0.000 7.00952E-23
3 16  -0.250  0.375 0.000 7.00952E-23
3 17  0.000 0.250 0.375 7.00952E-23
3 18  0.000 -0.250  -0.375  7.00952E-23
4 9 -0.375  -0.250  0.000 7.00952E-23
4 10  0.375 0.250 0.000 7.00952E-23
4 11  0.000 -0.375  0.250 7.00952E-23
4 12  0.000 0.375 -0.250  7.00952E-23
4 17  0.250 0.000 -0.375  7.00952E-23
4 18  -0.250  0.000 0.375 7.00952E-23
5 11  0.000 -0.375  -0.250  7.00952E-23
5 12  0.000 0.375 0.250 7.00952E-23
5 13  -0.250  0.000 0.375 7.00952E-23
5 14  0.250 0.000 -0.375  7.00952E-23
5 19  -0.375  0.250 0.000 7.00952E-23
5 20  0.375 -0.250  0.000 7.00952E-23
6 13  0.000 0.250 -0.375  7.00952E-23
6 14  0.000 -0.250  0.375 7.00952E-23
6 15  -0.250  -0.375  0.000 7.00952E-23
6 16  0.250 0.375 0.000 7.00952E-23
6 19  0.375 0.000 -0.250  7.00952E-23
6 20  -0.375  0.000 0.250 7.00952E-23
7 15  0.000 0.375 0.250 7.00952E-23
7 16  0.000 -0.375  -0.250  7.00952E-23
7 17  -0.250  0.000 -0.375  7.00952E-23
7 18  0.250 0.000 0.375 7.00952E-23
7 19  -0.375  -0.250  0.000 7.00952E-23
7 20  0.375 0.250 0.000 7.00952E-23
8 11  -0.250  0.375 0.000 7.00952E-23
8 12  0.250 -0.375  0.000 7.00952E-23
8 17  0.000 -0.250  0.375 7.00952E-23
8 18  0.000 0.250 -0.375  7.00952E-23
8 19  0.375 0.000 0.250 7.00952E-23
8 20  -0.375  0.000 -0.250  7.00952E-23
9 1 -0.375  0.000 -0.250  7.00952E-23
9 2 0.375 -0.250  0.000 7.00952E-23
9 3 -0.375  0.000 0.250 7.00952E-23
9 4 0.375 0.250 0.000 7.00952E-23
10  1 0.375 0.000 0.250 7.00952E-23
10  2 -0.375  0.250 0.000 7.00952E-23
10  3 0.375 0.000 -0.250  7.00952E-23
10  4 -0.375  -0.250  0.000 7.00952E-23
11  1 -0.250  -0.375  0.000 7.00952E-23
11  4 0.000 0.375 -0.250  7.00952E-23
11  5 0.000 0.375 0.250 7.00952E-23
11  8 0.250 -0.375  0.000 7.00952E-23
12  1 0.250 0.375 0.000 7.00952E-23
12  4 0.000 -0.375  0.250 7.00952E-23
12  5 0.000 -0.375  -0.250  7.00952E-23
12  8 -0.250  0.375 0.000 7.00952E-23
13  1 0.000 0.250 0.375 7.00952E-23
13  2 -0.250  0.000 -0.375  7.00952E-23
13  5 0.250 0.000 -0.375  7.00952E-23
13  6 0.000 -0.250  0.375 7.00952E-23
14  1 0.000 -0.250  -0.375  7.00952E-23
14  2 0.250 0.000 0.375 7.00952E-23
14  5 -0.250  0.000 0.375 7.00952E-23
14  6 0.000 0.250 -0.375  7.00952E-23
15  2 0.000 -0.375  0.250 7.00952E-23
15  3 -0.250  0.375 0.000 7.00952E-23
15  6 0.250 0.375 0.000 7.00952E-23
15  7 0.000 -0.375  -0.250  7.00952E-23
16  2 0.000 0.375 -0.250  7.00952E-23
16  3 0.250 -0.375  0.000 7.00952E-23
16  6 -0.250  -0.375  0.000 7.00952E-23
16  7 0.000 0.375 0.250 7.00952E-23
17  3 0.000 -0.250  -0.375  7.00952E-23
17  4 -0.250  0.000 0.375 7.00952E-23
17  7 0.250 0.000 0.375 7.00952E-23
17  8 0.000 0.250 -0.375  7.00952E-23
18  3 0.000 0.250 0.375 7.00952E-23
18  4 0.250 0.000 -0.375  7.00952E-23
18  7 -0.250  0.000 -0.375  7.00952E-23
18  8 0.000 -0.250  0.375 7.00952E-23
19  5 0.375 -0.250  0.000 7.00952E-23
19  6 -0.375  0.000 0.250 7.00952E-23
19  7 0.375 0.250 0.000 7.00952E-23
19  8 -0.375  0.000 -0.250  7.00952E-23
20  5 -0.375  0.250 0.000 7.00952E-23
20  6 0.375 0.000 -0.250  7.00952E-23
20  7 -0.375  -0.250  0.000 7.00952E-23
20  8 0.375 0.000 0.250 7.00952E-23
1 3 0.000 0.000 -0.500  9.01224E-23
1 3 0.000 0.000 0.500 9.01224E-23
1 6 0.000 0.500 0.000 9.01224E-23
1 6 0.000 -0.500  0.000 9.01224E-23
1 8 -0.500  0.000 0.000 9.01224E-23
1 8 0.500 0.000 0.000 9.01224E-23
2 4 0.000 0.500 0.000 9.01224E-23
2 4 0.000 -0.500  0.000 9.01224E-23
2 5 0.500 0.000 0.000 9.01224E-23
2 5 -0.500  0.000 0.000 9.01224E-23
2 7 0.000 0.000 -0.500  9.01224E-23
2 7 0.000 0.000 0.500 9.01224E-23
3 1 0.000 0.000 0.500 9.01224E-23
3 1 0.000 0.000 -0.500  9.01224E-23
3 6 -0.500  0.000 0.000 9.01224E-23
3 6 0.500 0.000 0.000 9.01224E-23
3 8 0.000 -0.500  0.000 9.01224E-23
3 8 0.000 0.500 0.000 9.01224E-23
4 2 0.000 -0.500  0.000 9.01224E-23
4 2 0.000 0.500 0.000 9.01224E-23
4 5 0.000 0.000 0.500 9.01224E-23
4 5 0.000 0.000 -0.500  9.01224E-23
4 7 -0.500  0.000 0.000 9.01224E-23
4 7 0.500 0.000 0.000 9.01224E-23
5 2 -0.500  0.000 0.000 9.01224E-23
5 2 0.500 0.000 0.000 9.01224E-23
5 4 0.000 0.000 -0.500  9.01224E-23
5 4 0.000 0.000 0.500 9.01224E-23
5 7 0.000 -0.500  0.000 9.01224E-23
5 7 0.000 0.500 0.000 9.01224E-23
6 1 0.000 -0.500  0.000 9.01224E-23
6 1 0.000 0.500 0.000 9.01224E-23
6 3 -0.500  0.000 0.000 9.01224E-23
6 3 0.500 0.000 0.000 9.01224E-23
6 8 0.000 0.000 0.500 9.01224E-23
6 8 0.000 0.000 -0.500  9.01224E-23
7 2 0.000 0.000 0.500 9.01224E-23
7 2 0.000 0.000 -0.500  9.01224E-23
7 4 0.500 0.000 0.000 9.01224E-23
7 4 -0.500  0.000 0.000 9.01224E-23
7 5 0.000 0.500 0.000 9.01224E-23
7 5 0.000 -0.500  0.000 9.01224E-23
8 1 0.500 0.000 0.000 9.01224E-23
8 1 -0.500  0.000 0.000 9.01224E-23
8 3 0.000 0.500 0.000 9.01224E-23
8 3 0.000 -0.500  0.000 9.01224E-23
8 6 0.000 0.000 -0.500  9.01224E-23
8 6 0.000 0.000 0.500 9.01224E-23
9 19  0.500 0.000 0.000 9.01224E-23
9 19  -0.500  0.000 0.000 9.01224E-23
10  20  -0.500  0.000 0.000 9.01224E-23
10  20  0.500 0.000 0.000 9.01224E-23
11  16  0.000 0.500 0.000 9.01224E-23
11  16  0.000 -0.500  0.000 9.01224E-23
12  15  0.000 -0.500  0.000 9.01224E-23
12  15  0.000 0.500 0.000 9.01224E-23
13  18  0.000 0.000 0.500 9.01224E-23
13  18  0.000 0.000 -0.500  9.01224E-23
14  17  0.000 0.000 -0.500  9.01224E-23
14  17  0.000 0.000 0.500 9.01224E-23
15  12  0.000 0.500 0.000 9.01224E-23
15  12  0.000 -0.500  0.000 9.01224E-23
16  11  0.000 -0.500  0.000 9.01224E-23
16  11  0.000 0.500 0.000 9.01224E-23
17  14  0.000 0.000 0.500 9.01224E-23
17  14  0.000 0.000 -0.500  9.01224E-23
18  13  0.000 0.000 -0.500  9.01224E-23
18  13  0.000 0.000 0.500 9.01224E-23
19  9 -0.500  0.000 0.000 9.01224E-23
19  9 0.500 0.000 0.000 9.01224E-23
20  10  0.500 0.000 0.000 9.01224E-23
20  10  -0.500  0.000 0.000 9.01224E-23
)");

auto& settings = config->lookup("hamiltonians");

auto neighbour_list = generate_neighbour_list(exc_file);

EXPECT_EQ(neighbour_list.num_interactions(), 424*8*8*8);

}




#endif //JAMS_TEST_INTERACTIONS_H
